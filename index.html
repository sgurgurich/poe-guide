<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POE2 Act Guide</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h1>Path of Exile 2 - Act Guide</h1>
        <div class="theme-toggle">
            <button class="theme-btn active" data-theme="dark">Dark</button>
            <button class="theme-btn" data-theme="light">Light</button>
        </div>
    </div>
    <div class="container">
        <div id="content" class="loading">Loading guide...</div>
    </div>

    <script>
        // Theme Management
        const initializeTheme = () => {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            applyTheme(savedTheme);
        };

        const applyTheme = (theme) => {
            const body = document.body;
            const buttons = document.querySelectorAll('.theme-btn');
            
            if (theme === 'light') {
                body.classList.add('light-mode');
            } else {
                body.classList.remove('light-mode');
            }
            
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.theme === theme) {
                    btn.classList.add('active');
                }
            });
            
            localStorage.setItem('theme', theme);
        };

        // Theme Button Listeners
        document.querySelectorAll('.theme-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                applyTheme(btn.dataset.theme);
            });
        });

        // Load Guide
        async function loadGuide() {
            try {
                const response = await fetch('poe2_act_guide.xml');
                if (!response.ok) {
                    throw new Error('Failed to load XML file');
                }
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                
                if (xmlDoc.getElementsByTagName('parsererror').length > 0) {
                    throw new Error('XML parsing error');
                }
                
                const content = document.getElementById('content');
                content.innerHTML = '';
                
                const acts = xmlDoc.getElementsByTagName('act');
                
                for (let act of acts) {
                    const actNumber = act.getAttribute('number');
                    const actDiv = document.createElement('div');
                    actDiv.className = 'act';
                    
                    const actHeader = document.createElement('div');
                    actHeader.className = 'act-header';
                    actHeader.style.cursor = 'pointer';
                    
                    const actTitle = document.createElement('div');
                    actTitle.className = 'act-title';
                    actTitle.textContent = `Act ${actNumber}`;
                    
                    const actToggle = document.createElement('span');
                    actToggle.className = 'act-toggle';
                    actToggle.textContent = '▼';
                    
                    actHeader.appendChild(actToggle);
                    actHeader.appendChild(actTitle);
                    actDiv.appendChild(actHeader);
                    
                    const actContent = document.createElement('div');
                    actContent.className = 'act-content';
                    actContent.style.display = 'block';
                    
                    const steps = act.getElementsByTagName('step');
                    
                    if (steps.length === 0) {
                        const emptyDiv = document.createElement('div');
                        emptyDiv.className = 'empty-act';
                        emptyDiv.textContent = 'Content coming soon...';
                        actContent.appendChild(emptyDiv);
                    } else {
                        for (let step of steps) {
                            const stepNumber = step.getAttribute('number');
                            const nameEl = step.getElementsByTagName('name')[0];
                            const name = nameEl ? nameEl.textContent : 'Unnamed';
                            
                            const stepDiv = document.createElement('div');
                            stepDiv.className = 'step';
                            
                            const stepNumberSpan = document.createElement('div');
                            stepNumberSpan.className = 'step-number';
                            stepNumberSpan.textContent = `Step ${stepNumber}`;
                            stepDiv.appendChild(stepNumberSpan);
                            
                            const stepNameDiv = document.createElement('div');
                            stepNameDiv.className = 'step-name';
                            stepNameDiv.textContent = name;
                            stepDiv.appendChild(stepNameDiv);
                            
                            const objectivesEl = step.getElementsByTagName('objectives')[0];
                            if (objectivesEl) {
                                const objectivesDiv = document.createElement('div');
                                objectivesDiv.className = 'objectives';
                                
                                const objectives = objectivesEl.getElementsByTagName('objective');
                                for (let obj of objectives) {
                                    const objDiv = document.createElement('div');
                                    objDiv.className = 'objective';
                                    objDiv.textContent = obj.textContent;
                                    objectivesDiv.appendChild(objDiv);
                                }
                                
                                stepDiv.appendChild(objectivesDiv);
                            }
                            
                            actContent.appendChild(stepDiv);
                        }
                    }
                    
                    actDiv.appendChild(actContent);
                    
                    // Add click handler to toggle expand/collapse
                    actHeader.addEventListener('click', () => {
                        const isOpen = actContent.style.display !== 'none';
                        actContent.style.display = isOpen ? 'none' : 'block';
                        actToggle.textContent = isOpen ? '▶' : '▼';
                    });
                    
                    content.appendChild(actDiv);
                }
            } catch (error) {
                const content = document.getElementById('content');
                content.innerHTML = `<div class="error">Error loading guide: ${error.message}<br><br>Make sure poe2_act_guide.xml is in the same directory as this HTML file.</div>`;
                console.error('Error:', error);
            }
        }
        
        // Initialize
        window.addEventListener('load', () => {
            initializeTheme();
            loadGuide();
        });
    </script>
</body>
</html>